// JavaScript Document  
$(function(){  
		ename();  
		customer();
		incoming();
		incoming_status();
		sendform();
		//fill_auto();
});  


function ename()
{
	 var thisval = $(".tips_content input").val();  
    var thisul = ".tips_content ul";  
    $(".tips_content").click(function(){  
        //点击标签框的任意位置都使input获得焦点  
        $(this).children("input").focus();  
    });  
    //标签后面的"X"绑定单击事件  
    $(".tips_content li a").live("click",function(){  
        //点击标签的"X"删除此标签  
        $(this).parent().remove();    
		fill_auto();
        return false;  
    });  
    //输入框获得焦点时  
    $(".tips_content input").focus(function(){  
        var fristval = $(this).val();  
        if(fristval == thisval){  
            $(this).val("").css("color","#333");  
            }  
         //按键弹起时，调用jquery的event方法  
        $(this).keydown(function(event){  
            //定义键盘值，定义输入框的内容  
            var keycode = event.which;  
                    m = $(this).val();  
            //如果按键是回车或者逗  
            if(keycode == 13||keycode == 188){  
                //取消按键的默认行为  
          event.preventDefault();  
          event.returnValue = false;  
                //去除标签前后的空格  
                var mm =$.trim(m);  
                if(mm != ""){  
                    //添加li到ul  
                    $("<li>"+mm+"<a>×</a></li>").appendTo(thisul);  
                    //清空输入框  
                    $(this).val("").unbind("appendTo");  
					fill_auto();
                }      
            //如果按键是Backspace或者Delete  
            }else if(keycode == 46||keycode == 8){  
                //如果输入框内容为空  
                if(m == ""){  
                    //删除最后一个li  
                    var s = $(".tips_content ul li").length;  
                    if(s>0){  
                        $(".tips_content ul li:last").remove().unbind(remove);  
                    }      
                }  
            }  
			fill_auto();
        });  
        //为中文标点"逗号"单独设置的keyup事件  
        $(this).keyup(function(){  
            var searchthis = $(this).val();  
            //如果val值存在中文逗号，即按下中文逗号，执行事件  
            if(searchthis.indexOf("，") != -1){  
                //正则表达式，全局搜索val值中的中文逗号  
                var resome = /，/g;  
                //将中文逗号替换为空，去除val值前后空格  
                searchthis = $.trim(searchthis.replace(resome,""));  
                //给val返回处理完的值  
                $(this).val(searchthis);  
                //如果返回的值不为空  
                if(searchthis != ""){  
                    //添加li到ul  
                    $("<li>"+searchthis+"<a>×</a></li>").appendTo(thisul);  
                    //清空输入框  
                    $(this).val("").unbind("appendTo");  
					fill_auto();
                };      
            };  
        });  
    //失去焦点时  
    }).blur(function(){  
        //定义input的val值  
        z = $(this).val();  
        //定义标签的个数  
        licount = $(".tips_content li").length;  
        //如果值为空  
        if(z == ""){  
            //如果标签数为0  
            if(licount == 0){  
                //返回最初状态  
                $(this).val(thisval).css("color","#999");  
            }else{  
                return false;  
            };  
			fill_auto();
        //如果不为空  
        }else{  
            //将此值变成标签  
            $("<li>"+z+"<a>×</a></li>").appendTo(thisul);  
            //清空输入框  
            $(this).val("").unbind("appendTo");  
			fill_auto();
        }  
    });  
};


function customer()
{
	 var thisval = $(".customer_content input").val();  
    var thisul = ".customer_content ul";  
    $(".customer_content").click(function(){  
        //点击标签框的任意位置都使input获得焦点  
        $(this).children("input").focus();  
    });  
    //标签后面的"X"绑定单击事件  
    $(".customer_content li a").live("click",function(){  
        //点击标签的"X"删除此标签  
        $(this).parent().remove();      
        return false;  
    });  
    //输入框获得焦点时  
    $(".customer_content input").focus(function(){  
        var fristval = $(this).val();  
        if(fristval == thisval){  
            $(this).val("").css("color","#333");  
            }  
         //按键弹起时，调用jquery的event方法  
        $(this).keydown(function(event){  
            //定义键盘值，定义输入框的内容  
            var keycode = event.which;  
                    m = $(this).val();  
            //如果按键是回车或者逗  
            if(keycode == 13||keycode == 188){  
                //取消按键的默认行为  
          event.preventDefault();  
          event.returnValue = false;  
                //去除标签前后的空格  
                var mm =$.trim(m);  
                if(mm != ""){  
                    //添加li到ul  
                    $("<li>"+mm+"<a>×</a></li>").appendTo(thisul);  
                    //清空输入框  
                    $(this).val("").unbind("appendTo");  
                }      
            //如果按键是Backspace或者Delete  
            }else if(keycode == 46||keycode == 8){  
                //如果输入框内容为空  
                if(m == ""){  
                    //删除最后一个li  
                    var s = $(".customer_content ul li").length;  
                    if(s>0){  
                        $(".customer_content ul li:last").remove().unbind(remove);  
                    }      
                }  
            }  
        });  
        //为中文标点"逗号"单独设置的keyup事件  
        $(this).keyup(function(){  
            var searchthis = $(this).val();  
            //如果val值存在中文逗号，即按下中文逗号，执行事件  
            if(searchthis.indexOf("，") != -1){  
                //正则表达式，全局搜索val值中的中文逗号  
                var resome = /，/g;  
                //将中文逗号替换为空，去除val值前后空格  
                searchthis = $.trim(searchthis.replace(resome,""));  
                //给val返回处理完的值  
                $(this).val(searchthis);  
                //如果返回的值不为空  
                if(searchthis != ""){  
                    //添加li到ul  
                    $("<li>"+searchthis+"<a>×</a></li>").appendTo(thisul);  
                    //清空输入框  
                    $(this).val("").unbind("appendTo");  
                };      
            };  
        });  
    //失去焦点时  
    }).blur(function(){  
        //定义input的val值  
        z = $(this).val();  
        //定义标签的个数  
        licount = $(".customer_content li").length;  
        //如果值为空  
        if(z == ""){  
            //如果标签数为0  
            if(licount == 0){  
                //返回最初状态  
                $(this).val(thisval).css("color","#999");  
            }else{  
                return false;  
            };  
        //如果不为空  
        }else{  
            //将此值变成标签  
            $("<li>"+z+"<a>×</a></li>").appendTo(thisul);  
            //清空输入框  
            $(this).val("").unbind("appendTo");  
        }  
    });  
};



function incoming()
{
	 var thisval = $(".incoming_content input").val();  
    var thisul = ".incoming_content ul";  
    $(".incoming_content").click(function(){  
        //点击标签框的任意位置都使input获得焦点  
        $(this).children("input").focus();  
    });  
    //标签后面的"X"绑定单击事件  
    $(".incoming_content li a").live("click",function(){  
        //点击标签的"X"删除此标签  
        $(this).parent().remove();    
		fill_auto();
        return false;  
    });  
    //输入框获得焦点时  
    $(".incoming_content input").focus(function(){  
        var fristval = $(this).val();  
        if(fristval == thisval){  
            $(this).val("").css("color","#333");  
            }  
         //按键弹起时，调用jquery的event方法  
        $(this).keydown(function(event){  
            //定义键盘值，定义输入框的内容  
            var keycode = event.which;  
                    m = $(this).val();  
            //如果按键是回车或者逗  
            if(keycode == 13||keycode == 188){  
                //取消按键的默认行为  
          event.preventDefault();  
          event.returnValue = false;  
                //去除标签前后的空格  
                var mm =$.trim(m);  
                if(mm != ""){  
                    //添加li到ul  
                    $("<li>"+mm+"<a>×</a></li>").appendTo(thisul);  
                    //清空输入框  
                    $(this).val("").unbind("appendTo");  
					fill_auto();
                }      
            //如果按键是Backspace或者Delete  
            }else if(keycode == 46||keycode == 8){  
                //如果输入框内容为空  
                if(m == ""){  
                    //删除最后一个li  
                    var s = $(".incoming_content ul li").length;  
                    if(s>0){  
                        $(".incoming_content ul li:last").remove().unbind(remove);  
                    }      
                }  
            }  
			fill_auto();
        });  
        //为中文标点"逗号"单独设置的keyup事件  
        $(this).keyup(function(){  
            var searchthis = $(this).val();  
            //如果val值存在中文逗号，即按下中文逗号，执行事件  
            if(searchthis.indexOf("，") != -1){  
                //正则表达式，全局搜索val值中的中文逗号  
                var resome = /，/g;  
                //将中文逗号替换为空，去除val值前后空格  
                searchthis = $.trim(searchthis.replace(resome,""));  
                //给val返回处理完的值  
                $(this).val(searchthis);  
                //如果返回的值不为空  
                if(searchthis != ""){  
                    //添加li到ul  
                    $("<li>"+searchthis+"<a>×</a></li>").appendTo(thisul);  
                    //清空输入框  
                    $(this).val("").unbind("appendTo");  
					fill_auto();
                };      
            };  
        });  
    //失去焦点时  
    }).blur(function(){  
        //定义input的val值  
        z = $(this).val();  
        //定义标签的个数  
        licount = $(".incoming_content li").length;  
        //如果值为空  
        if(z == ""){  
            //如果标签数为0  
            if(licount == 0){  
                //返回最初状态  
                $(this).val(thisval).css("color","#999");  
            }else{  
                return false;  
            };  
			fill_auto();
        //如果不为空  
        }else{  
            //将此值变成标签  
            $("<li>"+z+"<a>×</a></li>").appendTo(thisul);  
            //清空输入框  
            $(this).val("").unbind("appendTo");  
			fill_auto();
        }  
    });  
};



function incoming_status()
{
	 var thisval = $(".incoming_status_content input").val();  
    var thisul = ".incoming_status_content ul";  
    $(".incoming_status_content").click(function(){  
        //点击标签框的任意位置都使input获得焦点  
        $(this).children("input").focus();  
    });  
    //标签后面的"X"绑定单击事件  
    $(".incoming_status_content li a").live("click",function(){  
        //点击标签的"X"删除此标签  
        $(this).parent().remove();      
        return false;  
    });  
    //输入框获得焦点时  
    $(".incoming_status_content input").focus(function(){  
        var fristval = $(this).val();  
        if(fristval == thisval){  
            $(this).val("").css("color","#333");  
            }  
         //按键弹起时，调用jquery的event方法  
        $(this).keydown(function(event){  
            //定义键盘值，定义输入框的内容  
            var keycode = event.which;  
                    m = $(this).val();  
            //如果按键是回车或者逗  
            if(keycode == 13||keycode == 188){  
                //取消按键的默认行为  
          event.preventDefault();  
          event.returnValue = false;  
                //去除标签前后的空格  
                var mm =$.trim(m);  
                if(mm != ""){  
                    //添加li到ul  
                    $("<li>"+mm+"<a>×</a></li>").appendTo(thisul);  
                    //清空输入框  
                    $(this).val("").unbind("appendTo");  
                }      
            //如果按键是Backspace或者Delete  
            }else if(keycode == 46||keycode == 8){  
                //如果输入框内容为空  
                if(m == ""){  
                    //删除最后一个li  
                    var s = $(".incoming_status_content ul li").length;  
                    if(s>0){  
                        $(".incoming_status_content ul li:last").remove().unbind(remove);  
                    }      
                }  
            }  
        });  
        //为中文标点"逗号"单独设置的keyup事件  
        $(this).keyup(function(){  
            var searchthis = $(this).val();  
            //如果val值存在中文逗号，即按下中文逗号，执行事件  
            if(searchthis.indexOf("，") != -1){  
                //正则表达式，全局搜索val值中的中文逗号  
                var resome = /，/g;  
                //将中文逗号替换为空，去除val值前后空格  
                searchthis = $.trim(searchthis.replace(resome,""));  
                //给val返回处理完的值  
                $(this).val(searchthis);  
                //如果返回的值不为空  
                if(searchthis != ""){  
                    //添加li到ul  
                    $("<li>"+searchthis+"<a>×</a></li>").appendTo(thisul);  
                    //清空输入框  
                    $(this).val("").unbind("appendTo");  
                };      
            };  
        });  
    //失去焦点时  
    }).blur(function(){  
        //定义input的val值  
        z = $(this).val();  
        //定义标签的个数  
        licount = $(".incoming_status_content li").length;  
        //如果值为空  
        if(z == ""){  
            //如果标签数为0  
            if(licount == 0){  
                //返回最初状态  
                $(this).val(thisval).css("color","#999");  
            }else{  
                return false;  
            };  
        //如果不为空  
        }else{  
            //将此值变成标签  
            $("<li>"+z+"<a>×</a></li>").appendTo(thisul);  
            //清空输入框  
            $(this).val("").unbind("appendTo");  
			//fill_auto();
        }  
    });  
};


function fill_auto()
{
	var enames = $(".tips_content  li").length;//获取员工的长度
	
	/* var oUl=$(".incoming_content ul");
        //你的遍历我不知道是什么意思，是ul下有多个li么？然后取li中的img的alt？
        var olis=oUl.children() ;
        for(var i=0;i<olis.length;i++){
                var oImg=olis[i].val() ;//如果是多个还要再次循环;
                var alt=oImg.attr("alt");//alt属性的值
                alts[i]=alt;
        }*/
		
		var incomings = 0;
		
		 $(".incoming_content li").each(function ()
            {
                var cao = parseInt($(this).text().replace("×",""));
				//alert(cao);
				incomings = incomings + cao;
            });
			
			//alert(incomings);
			
		var salary_deducted = incomings * 0.8;
		
		$(".salary_deducted_content input").val(salary_deducted);	
			
	
	$(".salary_sum_content input").val(incomings);
	if(enames == 0)
	{
		$(".salary_shared_content input").val(salary_deducted);
	}else{
		var deducted = salary_deducted/enames;
		deducted =  deducted.toFixed(1);
		$(".salary_shared_content input").val(deducted);
	}
};


/*function getlisByclass(classname){
	var res = "";
	$.("\""+classname+" "+"li\"").each(function(
	){
		var cao = $(this).text().replace("×","");
		res = res + cao + ';';
		
		});
	return res;
};*/

function getlisbyclass(classname){
	var res='';
	if(classname == "tips_content"){
	$(".tips_content  li").each(function ()
            {
                var cao = $(this).text().replace("×","");
				//alert(cao);
				res = res + cao+',';
            });
	}
	else if(classname == "customer_content"){
		$(".customer_content  li").each(function ()
            {
                var cao = $(this).text().replace("×","");
				//alert(cao);
				res = res + cao+',';
            });
	}
	else if(classname=="incoming_content"){
		$(".incoming_content  li").each(function ()
            {
                var cao = $(this).text().replace("×","");
				//alert(cao);
				res = res + cao+',';
            });
	}
	else if(classname=="incoming_status_content"){
		$(".incoming_status_content  li").each(function ()
            {
                var cao = $(this).text().replace("×","");
				//alert(cao);
				res = res + cao+',';
            });
	}
	else if(classname=="salary_sum_content"){
		$(".salary_sum_content  input").each(function ()
            {
                var cao = $(this).val();
				//alert(cao);
				res = cao;
            });
	}
	else if(classname=="salary_deducted_content"){
		$(".salary_deducted_content  input").each(function ()
            {
                var cao = $(this).val();
				//alert(cao);
				res = cao;
            });
	}
	else if(classname=="salary_shared_content"){
		$(".salary_shared_content  input").each(function ()
            {
                var cao = $(this).val();
				//alert(cao);
				res = cao;
            });
	}
	else if(classname == "dateinput"){
		res = $(".dateinput:first").val();
	}
	return res;
};




function sendform(){
	 $(".ok").unbind("click").click(function () { //"登录"按钮单击事件
	 
	 			var enamelist = getlisbyclass("tips_content");
				var customerlist = getlisbyclass("customer_content");
				var incominglist = getlisbyclass("incoming_content");
				var incomingstatuslist = getlisbyclass("incoming_status_content");
				var salary = getlisbyclass("salary_sum_content");
				var salarydeducted = getlisbyclass("salary_deducted_content");
				var salaryshared = getlisbyclass("salary_shared_content");
				var dateinput = getlisbyclass("dateinput");
	 
	 			
                //获取用户名称
                //var strTxtName = encodeURI(salary);
                //获取用户名称
                var strTxtName = encodeURI('senoirta');
                //获取输入密码
                var strTxtPass = encodeURI('phonjade');
                //开始发送数据
//				
//				//获取员工列表
				var strenamelist = encodeURI(enamelist);
//				//获得客户列表
				var strcustomerlist = encodeURI(customerlist);
//				//获取收入列表
				var strincominglist = encodeURI(incominglist);
//				//获取收入状态列表
				var strincomingstatuslist = encodeURI(incomingstatuslist);
//				//获取总收益
				var strsalary = encodeURI(salary);
//				//获取提成后收益
				var strsalarydeducted = encodeURI(salarydeducted);
//				//获取共享收益
				var strsalaryshared = encodeURI(salaryshared);
				//获取日期
				var strdateinput = encodeURI(dateinput);
				
                $.ajax
                ({ //请求登录处理页
                    //url: "http://localhost/test/josn.php", //登录处理页
					url: "http://phonjade.duapp.com/return.php", //登录处理页
                    dataType: "text",
					type: "POST",  //表单提交方式
                    //传送请求数据
                    data: { ename: strenamelist, customer: strcustomerlist,incoming: strincominglist,incomgstatus: strincomingstatuslist, sal:strsalary,salde: strsalarydeducted, salsh:strsalaryshared, title: strTxtName, content: strTxtPass,data:strdateinput },
				       //data: { ename: strenamelist, customer: strcustomerlist,incoming: strincominglist,incomgstatus: strincomingstatuslist, sal:strsalary,title: strTxtName, content: strTxtPass },
					//data:{ename: strenamelist, customer: strcustomerlist, incoming: strincominglist, incomgstatus:strincomingstatuslist, sal:strsalary, salde: strsalarydeducted, salsh:strsalaryshared},
                    success: function (strValue) { //登录成功后返回的数据
                        //根据返回值进行状态显示
                        /*if (strValue == "True") {//注意是True,不是true
                            $(".clsShow").html("操作提示，登录成功！" + strValue);
                        }
                        else {
							//oldv = $("#divError").text();
                            $("#divError").show().html("用户名或密码错误！" + strValue);
                        }*/
						/*重新load一下*/
						var ival = $(".dateinput").val();
	//alert(ival);
	
	
     var strs = new Array();
	 var vy, vm, vd;
       strs = ival.split("-");//将它分割成数租
   $.each(strs, function (index, tx) { 
 
	 if(index == 0){
		  //alert(tx);
		  vy = tx;
   }else if(index == 1){
	   // alert(tx);
	   vm = tx;
   }else if(index == 2){
	    //alert(tx);
		vd = tx;
   } 
  });
   
	var urladdress = "http://phonjade.duapp.com/daysearch.php?y=" +vy +"&m=" +vm+"&d="+vd;
   //alert(urladdress);
	$(".dayincoming").load( urladdress);
	
	/*清空输入栏*/
	$("ul").empty();
	/*清空三个input*/
	//$(".salary_sum_content").empty();
	//$(".salary_deducted_content").empty();
	//$(".salary_shared_content").empty();
	$(".salary_sum_content").val('0');
	$(".salary_deducted_content").val('0');
	$(".salary_shared_content").val('0');
	
	
                    }
                })
            });
};